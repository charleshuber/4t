package fr.metz.surfthevoid.tttt.rest.resources;

import javax.transaction.Transactional;
import javax.transaction.Transactional.TxType;

import fr.metz.surfthevoid.tttt.rest.db.entity.GenericDbo;
import fr.metz.surfthevoid.tttt.rest.db.repo.GenericDao;

@Transactional(TxType.REQUIRED)
public abstract class Validator<R extends Resource, T extends GenericDbo> {
	
	public void validate(R input, Operation op) throws ValidationException {
		if(input == null){
			throw new ValidationException();
		}
		validateState(input, op);
		validateInput(input, op);
	}
	
	protected void validateState(R input, Operation op) throws ValidationException {
		if(op == Operation.CREATE && input.getId() != null){
			throw new ValidationException();
		} else if(op == Operation.UDPDATE){ 
			if(input.getId() == null){
				throw new ValidationException();
			} 
			GenericDbo dbo = getDao().read(input.getId());
			if(dbo == null){
				throw new ValidationException();
			}
		}
	}

	protected abstract void validateInput(R input, Operation op) throws ValidationException;
	protected abstract GenericDao<T> getDao();
	
	public static class ValidationException extends Exception {
		private static final long serialVersionUID = 6296828042739307519L;
		protected ValidationException(){}
	}
	
	public static class NotFoundException extends ValidationException {
		protected NotFoundException(){}
	}
}
